---
title: "STEM Data Wrangling"
author: "Erin Anthony"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#### Read in the data
```{r read in the data}
stem = read.csv("csv-data/all-data.csv") # 7357 obs of 150 variables
```

### Examine the variable levels of the data selection variables
```{r examine the variable levels of the data selection variables}
levels(stem$HD2015.Undergraduate.offering) # remove "No undergraduate offering"
levels(stem$HD2015.Degree.granting.status) # remove "Nondegree-granting, primarily postsecondary"
levels(stem$HD2015.Institution.is.active.in.current.year) # remove missing values
levels(stem$IC2015.Bachelor.s.degree) # remove missing values, remove "Implied no", remove "Not applicable"
```

### Examine the variable levels of the independent variables
```{r examine the variable levels of the independent variables}
levels(stem$HD2015.Bureau.of.Economic.Analysis..BEA..regions) # categorical, remove missing values
levels(stem$HD2015.Historically.Black.College.or.University) # binary, remove missing values
levels(stem$HD2015.Tribal.college) # binary, remove missing values
levels(stem$HD2015.Degree.of.urbanization..Urban.centric.locale.) # categorical, remove missing values
levels(stem$IC2015.Open.admission.policy) # binary, remove missing values, remove "Not applicable"
levels(stem$HD2015.Land.Grant.Institution) # binary, remove missing values
levels(stem$IC2015.Associate.s.degree) # binary, remove missing values
levels(stem$IC2015.All.programs.offered.completely.via.distance.education) # binary, remove missing values, remove "Not applicable", remove "Not reported"
levels(stem$IC2015.Undergraduate.programs.or.courses.are.offered.via.distance.education) # binary, remove missing values, remove "Not applicable", remove "Not reported"
levels(stem$IC2015.Study.abroad) # binary, remove missing values, remove "Not applicable", remove "Not reported"
levels(stem$IC2015.Weekend.evening..college) # binary, remove missing values, remove "Not applicable", remove "Not reported"
levels(stem$IC2015.Remedial.services) # binary, remove missing values, remove "Not applicable", remove "Not reported"
levels(stem$IC2015.Academic.career.counseling.service) # binary, remove missing values, remove "Not applicable", remove "Not reported"
levels(stem$IC2015.Employment.services.for.students) # binary, remove missing values, remove "Not applicable", remove "Not reported"
levels(stem$IC2015.Placement.services.for.completers) # binary, remove missing values, remove "Not applicable", remove "Not reported"
levels(stem$IC2015.On.campus.day.care.for.students..children) # binary, remove missing values, remove "Not applicable", remove "Not reported"
levels(stem$IC2015.Tuition.guaranteed.plan) # binary, remove missing values, remove "Not applicable", remove "Not reported"
levels(stem$IC2015.Prepaid.tuition.plan) # binary, remove missing values, remove "Not applicable", remove "Not reported"
levels(stem$IC2015.Tuition.payment.plan) # binary, remove missing values, remove "Not applicable", remove "Not reported"
levels(stem$IC2015.Institution.provide.on.campus.housing) # binary, remove missing values, remove "Not applicable", remove "Not reported"
levels(stem$IC2015.Institution.provides.board.or.meal.plan) # binary, combine the two "Yes" levels, remove missing values, remove "Not applicable", remove "Not reported"
levels(stem$IC2015_AY.In.state.average.tuition.for.full.time.undergraduates) # ratio, remove missing values
levels(stem$IC2015_AY.Out.of.state.average.tuition.for.full.time.undergraduates) # ratio, remove missing values
levels(stem$HD2015.Institution.size.category) # categorical, remove missing values, remove "Not applicable", remove "Not reported"
levels(stem$EF2015D.Student.to.faculty.ratio) # ratio, remove missing values
levels(stem$SFA1415.Average.amount.of.federal..state..local..institutional.or.other.sources.of.grant.aid.awarded.to.undergraduate.students) # ratio, remove missing values
levels(stem$SFA1415.Average.amount.of.federal.student.loans.awarded.to.undergraduate.students) # ratio, remove missing values
```

### Examine the variable levels of the dependent variables
```{r examine the variable levels of the dependent variables}
levels(stem$DRVEF2015.Percent.of.undergraduate.enrollment.that.are.Black.or.African.American) # ratio, remove missing values
levels(stem$DRVEF2015.Percent.of.undergraduate.enrollment.that.are.Hispanic.Latino) # ratio, remove missing values
levels(stem$DRVGR2015.Graduation.rate...Bachelor.degree.within.6.years..Black..non.Hispanic) # ratio, remove missing values
levels(stem$DRVGR2015.Graduation.rate...Bachelor.degree.within.6.years..Hispanic) # ratio, remove missing values
```

#### Trim the data set and rename the columns
```{r trim the data set and rename the columns}
stem.df <- stem[, c(10,12,18,26,8,13,14,15,17,21,24,34,35,38,39,40,
                      41,42,43,44,46,47,48,49,50,51,53,71,113,117,121,
                      93,94,144,145)] # 7357 obs of 35 variables

colnames(stem.df) <- c("ugrad", "degree", "active", "bachelors", "region", "hbcu", "tribal", "urban", "open", "landGrant", "associates", "allDistance", "partDistance", "studyAbroad", "weekend", "remedial", "counseling", "employment", "placement", "dayCare", "tuitionGuarantee", "tuitionPrepaid", "tuitionPlan", "oncampusHousing", "mealPlan", "instateTuition", "outstateTuition", "size", "facultyRatio", "grantAid", "loadAid", "blackEnroll", "latinoEnroll", "blackGrad", "latinoGrad")
```

#### Only include active institutions granting Bachelor's degrees
```{r only include active institutions granting Bachelor's degrees}
stem.df <- subset(stem.df, ugrad=="Undergraduate degree or certificate offering" & degree=="Degree-granting" & active=="Yes" & bachelors=="Yes") # 2752 obs of 35 variables
```

#### Remove missing values
```{r remove missing values}
stem.df.clean <- na.omit(stem.df) # 1722 obs of 35 variables
```

#### Feature engineer some new independent variables
```{r feature engineer some new independent variables}
# combine employment and placement services
stem.df.clean$placeEmploy <- with(stem.df.clean, ifelse(employment=="Yes"|placement=="Yes", "Yes", "No"))

# combine tuition guarantee, prepaid tuition, and tuition payment plan
stem.df.clean$tuitionOptions <- with(stem.df.clean, ifelse(tuitionGuarantee=="Yes"|tuitionPlan=="Yes"|tuitionPrepaid=="Yes", "Yes", "No"))

# calculate the ratio of out-of-state to in-state tuition
stem.df.clean$tuitionRatio <- stem.df.clean$outstateTuition/stem.df.clean$instateTuition
```